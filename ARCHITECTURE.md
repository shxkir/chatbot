# System Architecture - PDF-RAG Chatbot

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Browser                             â”‚
â”‚                     http://localhost:3001                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  LangChain Pages    â”‚      â”‚  Original Pages     â”‚
         â”‚  â­ Recommended     â”‚      â”‚                     â”‚
         â”‚                     â”‚      â”‚                     â”‚
         â”‚  /langchain-upload  â”‚      â”‚  /upload            â”‚
         â”‚  /langchain-chat    â”‚      â”‚  /chat              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                            â”‚
                    â”‚    CORS Enabled            â”‚
                    â”‚                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         Express Backend (Node.js)                 â”‚
         â”‚         http://localhost:5001                     â”‚
         â”‚                                                    â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚  â”‚  LangChain Routes â­                        â”‚ â”‚
         â”‚  â”‚  POST /api/langchain/upload                 â”‚ â”‚
         â”‚  â”‚  POST /api/langchain/query                  â”‚ â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â”‚                                                    â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚  â”‚  Original Routes                            â”‚ â”‚
         â”‚  â”‚  POST /api/upload                           â”‚ â”‚
         â”‚  â”‚  POST /api/query                            â”‚ â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”
         â”‚  LangChain       â”‚  â”‚  OpenAI   â”‚  â”‚ Pineconeâ”‚
         â”‚  Framework       â”‚  â”‚  API      â”‚  â”‚ Vector  â”‚
         â”‚                  â”‚  â”‚           â”‚  â”‚   DB    â”‚
         â”‚  - RecursiveChar â”‚  â”‚ Embedding â”‚  â”‚         â”‚
         â”‚    TextSplitter  â”‚  â”‚ ChatGPT   â”‚  â”‚ Vectors â”‚
         â”‚  - PineconeStore â”‚  â”‚           â”‚  â”‚ Metadataâ”‚
         â”‚  - Prompt        â”‚  â”‚           â”‚  â”‚         â”‚
         â”‚    Templates     â”‚  â”‚           â”‚  â”‚         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## PDF Upload Flow (LangChain)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User     â”‚
â”‚ selects PDF â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Frontend (LangChainUploader.tsx)          â”‚
â”‚    - Create FormData with file               â”‚
â”‚    - POST to /api/langchain/upload           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Backend (langchain-upload.js)             â”‚
â”‚    - Validate file (PDF, max 25MB)           â”‚
â”‚    - Extract text with pdf-parse             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LangChain Text Splitting                  â”‚
â”‚    RecursiveCharacterTextSplitter            â”‚
â”‚    - chunkSize: 1500                         â”‚
â”‚    - chunkOverlap: 200                       â”‚
â”‚    Result: Array of Document objects         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Create Embeddings                         â”‚
â”‚    OpenAIEmbeddings                          â”‚
â”‚    - Model: text-embedding-3-small           â”‚
â”‚    - Dimensions: 1536                        â”‚
â”‚    Result: Vector arrays for each chunk      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Store in Pinecone                         â”‚
â”‚    PineconeStore.fromDocuments()             â”‚
â”‚    - Namespace: pdf_<timestamp>              â”‚
â”‚    - Includes metadata (text, source)        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Return Response                           â”‚
â”‚    {                                         â”‚
â”‚      namespace: "pdf_1699564123456",         â”‚
â”‚      chunksIndexed: 127,                     â”‚
â”‚      fileName: "document.pdf"                â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Frontend Stores & Redirects              â”‚
â”‚    localStorage.set('langchain-namespace')   â”‚
â”‚    router.push('/langchain-chat')            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Chat Query Flow (LangChain RAG)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User     â”‚
â”‚ asks questionâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Frontend (LangChainChat.tsx)              â”‚
â”‚    - POST to /api/langchain/query            â”‚
â”‚    - Body: { question, namespace }           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Backend (langchain-query.js)              â”‚
â”‚    - Validate inputs                         â”‚
â”‚    - Check namespace exists                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Create Vector Store                       â”‚
â”‚    PineconeStore.fromExistingIndex()         â”‚
â”‚    - Connect to namespace                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Embed Question                            â”‚
â”‚    OpenAIEmbeddings                          â”‚
â”‚    - Convert question to 1536-dim vector     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Similarity Search                         â”‚
â”‚    vectorStore.similaritySearchWithScore()   â”‚
â”‚    - Top K: 5 chunks                         â”‚
â”‚    - Cosine similarity                       â”‚
â”‚    Result: [(doc, score), (doc, score), ...] â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Build Context                             â”‚
â”‚    Concatenate retrieved chunks:             â”‚
â”‚    "[Snippet 1, score: 0.89]                 â”‚
â”‚     {chunk text}                             â”‚
â”‚     ---                                      â”‚
â”‚     [Snippet 2, score: 0.85]                 â”‚
â”‚     {chunk text}..."                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Format RAG Prompt                         â”‚
â”‚    PromptTemplate.fromTemplate()             â”‚
â”‚    "Context: {context}                       â”‚
â”‚     Question: {question}                     â”‚
â”‚     Answer using only the context..."        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Generate Answer                           â”‚
â”‚    ChatOpenAI (gpt-4o-mini)                  â”‚
â”‚    - Temperature: 0.2 (focused)              â”‚
â”‚    - Input: Formatted prompt                 â”‚
â”‚    Result: AI-generated answer               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. Return Response                          â”‚
â”‚     {                                        â”‚
â”‚       reply: "Based on the document...",     â”‚
â”‚       references: [                          â”‚
â”‚         { rank: 1, score: 0.89, text, src }, â”‚
â”‚         { rank: 2, score: 0.85, text, src }  â”‚
â”‚       ]                                      â”‚
â”‚     }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. Frontend Displays                        â”‚
â”‚     - Show answer in chat bubble             â”‚
â”‚     - Show references with scores            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

### Backend

```
backend/
â”‚
â”œâ”€â”€ server.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”œâ”€â”€ Express app            â”‚
â”‚   â”œâ”€â”€ CORS middleware         â”‚
â”‚   â””â”€â”€ Route mounting          â”‚
â”‚                               â”‚
â”œâ”€â”€ routes/                     â”‚
â”‚   â”œâ”€â”€ langchain-upload.js â—„â”€â”€â”¤ Mount at /api/langchain/upload
â”‚   â”‚   â”œâ”€â”€ Multer config      â”‚
â”‚   â”‚   â”œâ”€â”€ Validation         â”‚
â”‚   â”‚   â””â”€â”€ Call langchain.js  â”‚
â”‚   â”‚                           â”‚
â”‚   â”œâ”€â”€ langchain-query.js â—„â”€â”€â”€â”¤ Mount at /api/langchain/query
â”‚   â”‚   â”œâ”€â”€ Validation         â”‚
â”‚   â”‚   â””â”€â”€ Call langchain.js  â”‚
â”‚   â”‚                           â”‚
â”‚   â”œâ”€â”€ upload.js â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Mount at /api/upload (original)
â”‚   â””â”€â”€ chat.js â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Mount at /api/query (original)
â”‚                               â”‚
â”œâ”€â”€ services/                   â”‚
â”‚   â”œâ”€â”€ langchain.js â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”‚   â”œâ”€â”€ extractTextFromPdf()
â”‚   â”‚   â”œâ”€â”€ processPdfWithLangChain()
â”‚   â”‚   â”œâ”€â”€ queryWithRAG()
â”‚   â”‚   â””â”€â”€ getPineconeStats()
â”‚   â”‚
â”‚   â”œâ”€â”€ embeddings.js (original)
â”‚   â”œâ”€â”€ pinecone.js (original)
â”‚   â””â”€â”€ pdf.js (original)
â”‚
â””â”€â”€ config/
    â””â”€â”€ env.js
        â”œâ”€â”€ dotenv config
        â””â”€â”€ Environment validation
```

### Frontend

```
frontend/src/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ langchain-upload/
â”‚   â”‚   â””â”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º LangChainUploader component
â”‚   â”‚
â”‚   â”œâ”€â”€ langchain-chat/
â”‚   â”‚   â””â”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º LangChainChat component
â”‚   â”‚                            + useLangChainChat hook
â”‚   â”‚
â”‚   â””â”€â”€ (protected)/
â”‚       â”œâ”€â”€ upload/page.tsx (original)
â”‚       â””â”€â”€ chat/page.tsx (original)
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LangChainUploader.tsx
â”‚   â”‚   â”œâ”€â”€ File input
â”‚   â”‚   â”œâ”€â”€ Upload button
â”‚   â”‚   â”œâ”€â”€ Status display
â”‚   â”‚   â””â”€â”€ Calls: uploadPdfWithLangChain()
â”‚   â”‚
â”‚   â”œâ”€â”€ LangChainChat.tsx
â”‚   â”‚   â”œâ”€â”€ Message list
â”‚   â”‚   â”œâ”€â”€ Input form
â”‚   â”‚   â”œâ”€â”€ References panel
â”‚   â”‚   â””â”€â”€ Receives: messages, onSend, busy, refs
â”‚   â”‚
â”‚   â”œâ”€â”€ FileUploader.tsx (original)
â”‚   â””â”€â”€ ChatUI.tsx (original)
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useLangChainChat.ts
â”‚   â”‚   â”œâ”€â”€ State: messages, busy, error, refs
â”‚   â”‚   â”œâ”€â”€ Function: sendMessage()
â”‚   â”‚   â””â”€â”€ Calls: queryWithLangChain()
â”‚   â”‚
â”‚   â””â”€â”€ useChat.ts (original)
â”‚
â””â”€â”€ lib/
    â”œâ”€â”€ langchainApi.ts
    â”‚   â”œâ”€â”€ uploadPdfWithLangChain()
    â”‚   â”‚   â””â”€â”€ POST /api/langchain/upload
    â”‚   â”‚
    â”‚   â””â”€â”€ queryWithLangChain()
    â”‚       â””â”€â”€ POST /api/langchain/query
    â”‚
    â””â”€â”€ backendApi.ts (original)
```

## Data Flow

### Upload Data Structure

```javascript
// 1. User uploads file
File {
  name: "document.pdf",
  size: 1024000,
  type: "application/pdf"
}

// 2. Backend extracts text
text: "Lorem ipsum dolor sit amet..."  // Full PDF text

// 3. LangChain splits into chunks
docs: [
  Document {
    pageContent: "Lorem ipsum dolor...",  // Chunk 1
    metadata: { source: "document.pdf", timestamp: "2024..." }
  },
  Document {
    pageContent: "Consectetur adipiscing...",  // Chunk 2
    metadata: { source: "document.pdf", timestamp: "2024..." }
  },
  // ... 127 chunks total
]

// 4. Embeddings created
embeddings: [
  [0.123, -0.456, 0.789, ...],  // 1536 dimensions
  [0.234, -0.567, 0.890, ...],
  // ... one per chunk
]

// 5. Stored in Pinecone
namespace: "pdf_1699564123456"
vectors: [
  {
    id: "0",
    values: [0.123, -0.456, ...],
    metadata: { text: "Lorem ipsum...", source: "document.pdf" }
  },
  // ... all chunks
]

// 6. Response to frontend
{
  message: "PDF processed successfully",
  namespace: "pdf_1699564123456",
  fileName: "document.pdf",
  chunksIndexed: 127
}
```

### Query Data Structure

```javascript
// 1. User question
question: "What is this document about?"

// 2. Question embedding
queryVector: [0.345, -0.678, 0.901, ...]  // 1536 dimensions

// 3. Pinecone similarity search
results: [
  {
    doc: Document {
      pageContent: "This document discusses...",
      metadata: { source: "document.pdf" }
    },
    score: 0.89
  },
  {
    doc: Document {
      pageContent: "The main topics include...",
      metadata: { source: "document.pdf" }
    },
    score: 0.85
  },
  // ... top 5 results
]

// 4. Context for ChatGPT
context: `
[Snippet 1, relevance: 0.890]
This document discusses...

---

[Snippet 2, relevance: 0.850]
The main topics include...
`

// 5. ChatGPT prompt
prompt: `
Context from the document:
{context}

Question: What is this document about?

Instructions: Answer using only the information from the context...
`

// 6. ChatGPT response
reply: "Based on the provided context, this document discusses..."

// 7. Response to frontend
{
  question: "What is this document about?",
  reply: "Based on the provided context...",
  references: [
    {
      rank: 1,
      score: 0.89,
      textPreview: "This document discusses...",
      source: "document.pdf"
    },
    {
      rank: 2,
      score: 0.85,
      textPreview: "The main topics include...",
      source: "document.pdf"
    }
  ],
  namespace: "pdf_1699564123456"
}
```

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Frontend Layer                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Next.js 14 (React 18)                     â”‚
â”‚ - TypeScript                                 â”‚
â”‚ - Axios (HTTP client)                        â”‚
â”‚ - CSS-in-JS (styled-jsx)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                  HTTP/REST
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend Layer                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Node.js (ES6 modules)                     â”‚
â”‚ - Express 4                                  â”‚
â”‚ - CORS middleware                            â”‚
â”‚ - Multer (file upload)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LangChain  â”‚  â”‚ OpenAI   â”‚  â”‚ Pinecone â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - langchainâ”‚  â”‚ Embeddingâ”‚  â”‚ Vector   â”‚
â”‚ - @langch/ â”‚  â”‚ Chat     â”‚  â”‚ Storage  â”‚
â”‚   openai   â”‚  â”‚ API      â”‚  â”‚ Search   â”‚
â”‚ - @langch/ â”‚  â”‚          â”‚  â”‚          â”‚
â”‚   pinecone â”‚  â”‚          â”‚  â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Environment Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Environment Variables                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  Backend (.env.local)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OPENAI_API_KEY=sk-proj-xxxxx          â”‚  â”‚
â”‚  â”‚ PINECONE_API_KEY=pcsk-xxxxx           â”‚  â”‚
â”‚  â”‚ PINECONE_INDEX_NAME=pdf-chatbot       â”‚  â”‚
â”‚  â”‚ PORT=5001                              â”‚  â”‚
â”‚  â”‚ FRONTEND_URL=http://localhost:3001    â”‚  â”‚
â”‚  â”‚ CHUNK_SIZE=1500                        â”‚  â”‚
â”‚  â”‚ CHUNK_OVERLAP=200                      â”‚  â”‚
â”‚  â”‚ RETRIEVAL_TOP_K=5                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚  Frontend (.env.local)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ NEXT_PUBLIC_API_URL=http://localhost  â”‚  â”‚
â”‚  â”‚                     :5001              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deployment Architecture (Production)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              User's Browser                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ HTTPS
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Vercel / Netlify (Frontend)           â”‚
â”‚         https://your-app.vercel.app           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ HTTPS + CORS
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Railway / Render (Backend)               â”‚
â”‚      https://your-api.railway.app             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚              â”‚
       â–¼            â–¼              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚OpenAI  â”‚  â”‚Pinecone â”‚   â”‚  Env     â”‚
  â”‚  API   â”‚  â”‚  Cloud  â”‚   â”‚ Variablesâ”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Summary

This architecture provides:

âœ… **Separation of Concerns**: Clear boundaries between layers
âœ… **Scalability**: Each component can scale independently
âœ… **Maintainability**: Well-organized, documented code
âœ… **Extensibility**: Easy to add features
âœ… **Type Safety**: TypeScript throughout
âœ… **Error Handling**: Comprehensive error management
âœ… **Security**: Environment variables, CORS, validation
âœ… **Performance**: Efficient chunking, batching, caching
âœ… **User Experience**: Loading states, error messages, smooth flow

Ready to deploy and scale! ğŸš€
